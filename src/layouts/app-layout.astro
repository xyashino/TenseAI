---
import { DesktopSidebar } from "@/components/layout/desktop-sidebar";
import { MobileLayout } from "@/components/layout/mobile-layout";
import { cn } from "@/lib/utils";
import BaseLayout from "./base-layout.astro";

interface Props {
  title?: string;
  mainClassName?: string;
}

const { title = "TenseAI", mainClassName = "" } = Astro.props;

const session = Astro.locals.user;
const profile = Astro.locals.profile;

if (!session) {
  return Astro.redirect("/login", 302);
}

if (profile && !profile.onboarding_completed) {
  return Astro.redirect("/onboarding", 302);
}

const currentPath = Astro.url.pathname;
---

<BaseLayout title={title} className="min-h-screen bg-background">
  <div class="flex h-screen overflow-hidden">
    <aside class="hidden lg:flex">
      <DesktopSidebar currentPath={currentPath} client:load />
    </aside>

    <div class="flex flex-1 flex-col overflow-hidden min-h-0">
      <div class="lg:hidden">
        <MobileLayout currentPath={currentPath} client:load />
      </div>
      <main
        class={cn("flex-1 overflow-y-auto p-6 pb-24 lg:p-8 lg:pb-8 min-h-0 w-full mx-auto max-w-4xl", mainClassName)}
      >
        <slot />
      </main>
    </div>
  </div>
</BaseLayout>
