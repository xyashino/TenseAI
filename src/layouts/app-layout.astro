---
import { AppLogo } from "@/components/app-logo";
import { LogoutDialogWithQueryClient } from "@/features/auth";
import { NavigationListWithQueryClient } from "@/components/common/navigation-list/navigation-list";
import { NavigationRoutes } from "@/lib/enums/navigation";
import { cn } from "@/lib/utils";
import BaseLayout from "./base-layout.astro";
interface Props {
  title?: string;
  mainClassName?: string;
}

const { title = "TenseAI", mainClassName = "" } = Astro.props;

const session = Astro.locals.user;
const profile = Astro.locals.profile;

if (!session) {
  return Astro.redirect(NavigationRoutes.LOGIN, 302);
}

if (profile && !profile.onboarding_completed) {
  return Astro.redirect(NavigationRoutes.ONBOARDING, 302);
}

const currentPath = Astro.url.pathname;
---

<BaseLayout title={title} className="bg-[#1a0f08] flex flex-col lg:flex-row h-screen">
  <aside class="hidden lg:flex flex-col justify-between h-full py-10">
    <div class="relative flex items-center justify-center p-6">
      <AppLogo showText={false} />
    </div>
    <nav class="relative">
      <NavigationListWithQueryClient currentPath={currentPath} client:load />
    </nav>
    <div class="relative">
      <LogoutDialogWithQueryClient client:load />
    </div>
  </aside>
  <div class="flex flex-1 flex-col w-full h-full lg:pr-6 lg:py-6 px-2 lg:pl-0 lg:pb-4">
    <header class="flex items-center justify-between lg:hidden w-full p-4">
      <AppLogo showText invert />
      <LogoutDialogWithQueryClient client:load />
    </header>
    <div class="w-full flex-1 min-h-0 bg-background rounded-lg lg:rounded-lg">
      <main
        class={cn(
          "w-full h-full flex flex-col max-w-4xl mx-auto px-4 py-8 lg:p-8 overflow-x-hidden no-scrollbar",
          mainClassName
        )}
      >
        <slot />
      </main>
    </div>
    <div class="flex items-center justify-between px-2 flex-shrink-0 lg:hidden">
      <NavigationListWithQueryClient currentPath={currentPath} client:load />
    </div>
  </div>
</BaseLayout>
