---
import { AccountForm } from "@/components/account/account-form";
import { ResetPasswordDialog } from "@/components/account/reset-password-dialog";
import AppLayout from "@/layouts/app-layout.astro";
import { ProfileRepository } from "@/server/repositories/profile.repository";

const supabase = Astro.locals.supabase;
const session = Astro.locals.user;

if (!session) {
  return Astro.redirect("/login");
}

const profileRepository = new ProfileRepository(supabase);
const profile = await profileRepository.getProfileById(session.id);
---

<AppLayout title="Account - TenseAI">
  <AccountForm initialProfile={profile} client:load />
  <div class="mt-4 pt-4 border-t">
    <div class="flex flex-col gap-4 sm:flex-row sm:items-center">
      <ResetPasswordDialog client:load />
    </div>
  </div>
</AppLayout>
